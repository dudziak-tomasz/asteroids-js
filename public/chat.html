<!DOCTYPE html>
<html lang="en">
    <head>
        <title>CHAT JS</title>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width,initial-scale=1.0">
    </head>
    <body>
        <!-- <script src="http://127.0.0.1:3000/socket.io/socket.io.js"></script> -->
        <!-- <script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script> -->

        <form id="form_chat">
            <input name="message" autocomplete="off">
            <button name="send">Send</button>
        </form>

        <script type="module">
            import { io } from "https://cdn.socket.io/4.3.2/socket.io.esm.min.js";
            import { config } from './js/config.js'
            import { api } from './js/api.js'

            // var socket = io('http://127.0.0.1:3000');
            // let socket = io('https://127.0.0.1:3443');
            let socket = io(config.getItem('apiPrefix'))
            // console.log(config.getItem('apiPrefix'))

            api.profile()

            socket.on('messageclient', (message) => {
                console.log(message)
            })

            const $formChat = document.querySelector('#form_chat')
            $formChat.message.focus()

            $formChat.addEventListener('submit', (e) => {
                e.preventDefault()

                const messageText = $formChat.message.value
                if (messageText !== '') {
                    const message = {
                        user: api.user,
                        token: api.getToken(),
                        text: messageText
                    }

                    socket.emit('messageserver', message)
                    $formChat.message.value = ''
                    $formChat.message.focus()
                }
                
            })

        </script>
    </body>
</html>